<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Calendar Manager</title>
    <script src="js/index.js"></script>
    <link rel="stylesheet" type="text/css" href="css/tables.css">
    <link rel="stylesheet" type="text/css" href="css/form.css">
    <style>
        textarea {
            width: 100%;
            min-height: 200px;
            margin: 10px 0;
        }
        button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 16px;
        }
        label {
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Collaborative Calendar Manager</h1>

    <textarea id="transformed_csv_textarea" style="display: none;">Hidden content</textarea>


        <div class="panel">
            <div class="form-row">
                <div class="form-group">
                    <label for="shiftStart">Shift Start:</label>
                    <select id="shiftStart">
                        <script>
                            // Generate time options from 0600 to 0600 next day
                            let select = document.getElementById('shiftStart');
                            let hour = 6;
                            let minute = 0;
                            let isNextDay = false;
                            select.add(new Option('Select', ''));
    
                            while (!(hour === 6 && minute === 0 && isNextDay)) {
                                let hourStr = hour.toString().padStart(2, '0');
                                let minuteStr = minute.toString().padStart(2, '0');
                                let timeStr = hourStr + minuteStr;
                                let displayTime = `${hourStr}${minuteStr}`;
                                
                                let option = new Option(displayTime, timeStr);
                                select.add(option);
    
                                minute += 30;
                                if (minute === 60) {
                                    minute = 0;
                                    hour++;
                                    if (hour === 24) {
                                        hour = 0;
                                        isNextDay = true;
                                    }
                                }
                            }
                        </script>
                    </select>
                </div>
    
                <div class="form-group">
                    <label for="shiftEnd">Shift End:</label>
                    <select id="shiftEnd">
                        <script>
                            let shiftEnd = document.getElementById('shiftEnd');
                            let options = document.getElementById('shiftStart').innerHTML;
                            shiftEnd.innerHTML = options;
                        </script>
                    </select>
                </div>
    
                <div class="form-group">
                    <label for="squads">Squads:</label>
                    <select id="squads">
                        <option value="">Select squad</option>
                        <option value="34">34</option>
                        <option value="35">35</option>
                        <option value="42">42</option>
                        <option value="43">43</option>
                        <option value="54">54</option>
                    </select>
                </div>
    
                <div class="form-group">
                    <label for="quickTimes">Quick Times:</label>
                    <select id="quickTimes">
                        <option value="">Select</option>
                        <option value="0600-1200">0600 - 1200</option>
                        <option value="1200-0600">1200 - 0600</option>
                        <option value="0600-1800">0600 - 1800</option>
                        <option value="1800-0000">1800 - 0000</option>
                        <option value="0000-0600">0000 - 0600</option>
                        <option value="1800-0600">1800 - 0600</option>
                    </select>
                </div>
    
                <div class="form-group">
                    <label for="currentShifts">Current Shifts:</label>
                    <select id="currentShifts">
                        <option value="">Select</option>
                        <option value="0600-1200">0600 - 1200</option>
                        <option value="1200-0600">1200 - 0600</option>
                        <option value="0600-1800">0600 - 1800</option>
                        <option value="1800-0000">1800 - 0000</option>
                        <option value="0000-0600">0000 - 0600</option>
                        <option value="1800-0600">1800 - 0600</option>
                    </select>
                </div>
            </div>
    
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="confirmCheckbox">
                    I confirm these changes
                </label>
            </div>
    
            <div class="button-group">
                <button class="add-btn">Add Shift</button>
                <button class="remove-btn">Remove Shift</button>
                <button class="obliterate-btn">Obliterate</button>
            </div>
        </div>
    



    <button id="copy" onclick="copyTest1ToClipboard('test1')">Test1</button>    
    <button id="parse" onclick="parse_input()">Parse</button>

    <label for="previewTable">Original</label>
    <table id="previewTable" class="styled-table"><thead><tr><th>Timeslot</th><th>Squad1</th><th>Squad2</th><th>Squad3</th></tr></thead><tbody></tbody></table>

    <label for="modifiedTable">Modified</label>
    <button class="add-btn">Revert</button>

    <table id="modifiedTable" class="styled-table"><thead><tr><th>Timeslot</th><th>Squad1</th><th>Squad2</th><th>Squad3</th></tr></thead><tbody></tbody></table>

    <button id="copy" onclick="copyToClipboard()">Copy</button>

    <script>

        function parse_input() {
            const outputTextarea = document.getElementById('transformed_csv_textarea');
            getClipboardText().then(inputText => {
                console.log(`Got input text: ${inputText}`);
                slots = parseSchedulePastedInput(inputText);
                console.log(JSON.stringify(slots));
                populate_shift_table('previewTable', slots);
                populate_shift_table('modifiedTable', slots);
                outputTextarea.value = slotsToSS(slots);
            });
        }

        function populate_shift_table(tableName, slots) {
            const table = document.getElementById(tableName);
            const tbody = table.getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';

            slots.forEach(slot => {
                const tr = document.createElement('tr');
                tableHtml = `<td>${padToFour(slot.startTime)} - ${padToFour(slot.endTime)}</td>`;
                const iterator = slot.squadIterator;
                let next = iterator.next();
                while (!next.done) {
                    console.log(next.value);
                    tableHtml += `<td>${next.value.call_id}(${next.value.number_of_trucks})<br/>[${next.value.territoriesCovered}]</td>`;
                    next = iterator.next();

                }
                tr.innerHTML = tableHtml;
                tbody.appendChild(tr);
            });
        }


        async function getClipboardText() {
            try {
                const text = await navigator.clipboard.readText();
                return text;
            } catch (err) {
                console.error('Failed to read clipboard:', err);
                return null;
            }
        }

        function copyToClipboard() {
            try {
                // Get the textarea element
                const textarea = document.getElementById('transformed_csv_textarea');
                
                // Select the text
                textarea.select();
                
                // Copy to clipboard
                navigator.clipboard.writeText(textarea.value)
                    .then(() => {
                        console.log('Text copied successfully');
                        // Optional: provide user feedback
                        alert('Copied to clipboard!');
                    })
                    .catch(err => {
                        console.error('Failed to copy text:', err);
                    });
                    
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        }

        function copyTest1ToClipboard(testcase) {
            let test_input = '';
            if (testcase == 'test1') {
                test_input = schedule_input;
            }
            try {
                // Get the textarea element
                
                // Copy to clipboard
                navigator.clipboard.writeText(test_input)
                    .then(() => {
                        console.log('Text copied successfully');
                        // Optional: provide user feedback
                        alert('Copied to clipboard!');
                    })
                    .catch(err => {
                        console.error('Failed to copy text:', err);
                    });
                    
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        }


        // function copyToClipboard() {
        //     const outputTextarea = document.getElementById('transformed_csv_textarea');
        //     console.log('Copying to clipboard:', outputTextarea.value);
        //     outputTextarea.select();
        //     document.execCommand('copy');
        //     alert('Copied to clipboard!');
        // }
    </script>
</body>
</html>
